"use strict";(self.webpackChunksmashub_github_io=self.webpackChunksmashub_github_io||[]).push([[962],{3905:(e,t,a)=>{a.d(t,{Zo:()=>h,kt:()=>u});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},h=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),p=d(a),u=i,m=p["".concat(s,".").concat(u)]||p[u]||c[u]||o;return a?n.createElement(m,r(r({ref:t},h),{},{components:a})):n.createElement(m,r({ref:t},h))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var d=2;d<o;d++)r[d]=a[d];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},5270:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var n=a(7462),i=(a(7294),a(3905));const o={sidebar_position:6},r="Dataset evaluation",l={unversionedId:"choco/dataset_evaluation",id:"choco/dataset_evaluation",title:"Dataset evaluation",description:"This section details the actions taken to evaluate the quality of ChoCO, both in",source:"@site/docs/choco/dataset_evaluation.md",sourceDirName:"choco",slug:"/choco/dataset_evaluation",permalink:"/docs/choco/dataset_evaluation",draft:!1,editUrl:"https://github.com/smashub/smashub.github.io/docs/docs/choco/dataset_evaluation.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Extra notes on partitions",permalink:"/docs/choco/metadata_license"}},s={},d=[{value:"JAMS-Test: a framework for test-driven evaluation",id:"jams-test-a-framework-for-test-driven-evaluation",level:2},{value:"Evaluation of the JAMification process",id:"evaluation-of-the-jamification-process",level:3},{value:"Step 1: Create a test set for the partition",id:"step-1-create-a-test-set-for-the-partition",level:4},{value:"Step 2: Run the evaluation with JAMS-Test",id:"step-2-run-the-evaluation-with-jams-test",level:4},{value:"Details: how gold JAMS were obtained",id:"details-how-gold-jams-were-obtained",level:3},{value:"Validation Guidelines",id:"validation-guidelines",level:4},{value:"What to validate?",id:"what-to-validate",level:4},{value:"Instructions for Validators",id:"instructions-for-validators",level:4},{value:"Music expert evaluation of conversions (S2)",id:"music-expert-evaluation-of-conversions-s2",level:2}],h={toc:d};function c(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"dataset-evaluation"},"Dataset evaluation"),(0,i.kt)("p",null,"This section details the actions taken to evaluate the quality of ChoCO, both in\nterms of JAMS output (accuracy of metadata and annotation), and chord conversion\nconsistency. If you want to replicate these experiments, please consider the\ninstructions below."),(0,i.kt)("h2",{id:"jams-test-a-framework-for-test-driven-evaluation"},"JAMS-Test: a framework for test-driven evaluation"),(0,i.kt)("h3",{id:"evaluation-of-the-jamification-process"},"Evaluation of the JAMification process"),(0,i.kt)("p",null,"The goal of the first validation step is to assess the quality and the expressivity of the JAMS files resulting from the JAMification process of ChoCo's partitions. Please, refer to ",(0,i.kt)("inlineCode",{parentName:"p"},"choco/jams_test.py")," to create test data and run the final evaluation."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Testing scripts for the JAMification of ChoCo partitions.\n\npositional arguments:\n  {create,merge,test}   Either `create` for generating the test samples or `test` for running the JAMS-based tests.\n  partition_dir         Path to the directory of the ChoCo partition in which the "meta.csv" file can be found.\n  {audio,score}         Type of music content in the collection.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --skip_silver         Whether to detect and skip silver JAMS files.\n  --n_samples N_SAMPLES\n                        Number of test samples to draw from the partition, create the test metadata, and skim the JAMS.\n  --keep_n KEEP_N       Number of chord/key observations per annotation that will be retained for the evaluation.\n  --seed SEED           A random seed for reproducible sampling.\n  --debug               Whether to enable debugging logs.\n\n')),(0,i.kt)("h4",{id:"step-1-create-a-test-set-for-the-partition"},"Step 1: Create a test set for the partition"),(0,i.kt)("p",null,"The first thing to do is to create a test set of silver JAMS files that will be manually edited, extended, revised, and eventually enriched by human annotators. For a single partition, say ",(0,i.kt)("inlineCode",{parentName:"p"},"isophonics"),", the following script generates a test set of 4 samples where only the first 5 observations are retained per chord/key annotation."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"cd choco\npython jams_tests.py create ../partitions/isophonics/choco/ audio --n_samples 4 --keep_n 5 --seed 1234\n")),(0,i.kt)("h4",{id:"step-2-run-the-evaluation-with-jams-test"},"Step 2: Run the evaluation with JAMS-Test"),(0,i.kt)("p",null,"Once you have manually annotated/revised the silver JAMS, thereby producing gold JAMS, it is time to measure the quality of the estimated JAMS files (in ChoCo, the output of the JAMification process). This is done by comparing the latter against the gold standard, with respect to specific sections/layer (this is fairly documented in our issues). To run the evaluation, you only need to provide the path to the specific ChoCo partition to validate: which is expected to contain a ",(0,i.kt)("inlineCode",{parentName:"p"},"test")," folder with the gold JAMS. Please, note that, if the test folder still contains the silver JAMS from the previous step, these can be safely ignored with the ",(0,i.kt)("inlineCode",{parentName:"p"},"--skip_silver")," option."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"cd choco\npython jams_test.py test ../tests/data/dummy-score-partition/ score --skip_silver\n")),(0,i.kt)("h3",{id:"details-how-gold-jams-were-obtained"},"Details: how gold JAMS were obtained"),(0,i.kt)("p",null,"This section contains information on how to validate JAMS files produced by JAMification process of ChoCo.The validation consists of checking the correctness of annotations automatically converted into a standardised format (JAMS). More specifically, validation consists of comparing the annotations contained in the JAMS file (automatically generated) with the original annotation files. Generally, each dataset originally contains annotations in a different formats."),(0,i.kt)("p",null,"Validation will take place on two levels:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"preliminary_test"),": a small number of tracks is assigned to each validator. The purpose of this validation phase is\nto assign a confidence score to the annotator, based on the accuracy of the test annotations produced;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"validation"),": the ChoCo datasets will be divided equally between the annotators and multiple tracks per dataset\nwill be assigned to each annotator.")),(0,i.kt)("h4",{id:"validation-guidelines"},"Validation Guidelines"),(0,i.kt)("p",null,"The annotations to be validated are assigned to validators in a csv file called ",(0,i.kt)("inlineCode",{parentName:"p"},"validator_map.csv"),".\nThis file has the following structure:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"th"},"dataset_name")),(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"th"},"dataset_type")),(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"th"},"validator")),(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"th"},"perliminary_test")))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Isophonics"),(0,i.kt)("td",{parentName:"tr",align:null},"audio"),(0,i.kt)("td",{parentName:"tr",align:null},"validator_name"),(0,i.kt)("td",{parentName:"tr",align:null},"True")))),(0,i.kt)("p",null,"The fields are described as follows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"dataset_name"),": the dataset that needs to be validated;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"dataset_type"),": the type of the chord annotations contained in the dataset, which can be either ",(0,i.kt)("inlineCode",{parentName:"li"},"score")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"audio"),";"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"validator"),": the person who will take care of the validation of the dataset;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"preliminary_test"),": boolean that indicates whether the dataset is part of the preliminary validation or not.")),(0,i.kt)("h4",{id:"what-to-validate"},"What to validate?"),(0,i.kt)("p",null,"There are several fields that need to be checked in the validation process, which can be grouped into the following\ncategories:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"file metadata"),": the metadata of the file being analyzed, which include the title the composer, the artist, etc.\nThis information is contained in the ",(0,i.kt)("inlineCode",{parentName:"li"},"file_metadata")," and in the ",(0,i.kt)("inlineCode",{parentName:"li"},"sandbox")," section of the JAMS files;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"annotations"),": general category that contains annotations related to the song. Specifically within this section it is\nimportant to validate:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"annotation metadata"),": metadata related to the annotation and the annotator;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"chord observations"),": chord annotations, including timing information. For each observation, it is therefore\nessential to\nvalidate both the accuracy of the chord itself, its duration and its starting time;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"key annotations"),": annotations about the song's key, including temporal indications. For each key annotation,\nit is therefore essential to validate both the accuracy of the key label, its duration and its starting time.")))),(0,i.kt)("p",null,"There are two main types of annotations contained in a JAMS file:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Audio annotations: contain time information expressed in real time (seconds);"),(0,i.kt)("li",{parentName:"ol"},"Score annotations: contain time expressed symbolically. In particular, timing information is expressed through the\nconvention ",(0,i.kt)("inlineCode",{parentName:"li"},"beasure.beat")," while duration is expressed in ",(0,i.kt)("inlineCode",{parentName:"li"},"quarter_beat"),".")),(0,i.kt)("p",null,"You can get more information regarding these conventions and the structure of the JAMS files in the Wiki section of the\nChoCo repository, at ",(0,i.kt)("a",{parentName:"p",href:"./choco_jams"},"this link"),"."),(0,i.kt)("p",null,"In order to make validation faster and simpler, the JAMS files have been further simplified, in order to reduce the number of\nchords to be validated and consequently the complexity of the files.\nEach file was in fact simplified using one of the following strategies:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"last_n"),": only the last n chords are taken into account;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"first_n"),": only the first n chords are considered.")),(0,i.kt)("p",null,"Within the ",(0,i.kt)("inlineCode",{parentName:"p"},"partitions/partition_name/test")," folder, files simplified according to the aforementioned strategies\n(i.e. ",(0,i.kt)("inlineCode",{parentName:"p"},"first_n")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"last_n"),") have already been generated.\\\nIn the same folder, you can also find the file ",(0,i.kt)("inlineCode",{parentName:"p"},"test_meta.csv"),", which contains information concerning the creation of\nthe validation files, such as the simplification strategy used, their name, and the path of both the original file\nand the file to be validated."),(0,i.kt)("h4",{id:"instructions-for-validators"},"Instructions for Validators"),(0,i.kt)("p",null,"The validation process should be organised as follows:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"fork the ChoCo repository, by clicking on the ",(0,i.kt)("inlineCode",{parentName:"p"},"fork")," button on the top right of the repository page")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"clone the forked repository:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-commandline"},"git clone <link_to_your_repository>\n")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"enter the repository:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-commandline"},"cd choco\n")),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"switch to the 'validation' branch via:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-commandline"},"git switch validation\n")),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},"check in the ",(0,i.kt)("inlineCode",{parentName:"li"},"validator_map.csv")," file which dataset has been associated with you"),(0,i.kt)("li",{parentName:"ol"},"look for the JAMS files to validate in the ",(0,i.kt)("inlineCode",{parentName:"li"},"partitions/dataset_name/test")," folder"),(0,i.kt)("li",{parentName:"ol"},"duplicate each file by adding your name to the file name, e.g., ",(0,i.kt)("inlineCode",{parentName:"li"},"isophonics_73_silver.jams")," will\nbecome ",(0,i.kt)("inlineCode",{parentName:"li"},"isophonics_3_silver_yourname.jams")),(0,i.kt)("li",{parentName:"ol"},"for each file in the validation folder of the assigned dataset, look for the corresponding original file that is\nmapped to the ",(0,i.kt)("inlineCode",{parentName:"li"},"meta.csv")," file, that can be found in the ",(0,i.kt)("inlineCode",{parentName:"li"},"partitions/dataset_name/choco")," folder"),(0,i.kt)("li",{parentName:"ol"},"validate the JAMS against the original files, taking into account the simplification strategy used for each file,\nwhich can be found in ",(0,i.kt)("inlineCode",{parentName:"li"},"partitions/dataset_name/test/test_meta.csv")),(0,i.kt)("li",{parentName:"ol"},"edit the renamed file (",(0,i.kt)("inlineCode",{parentName:"li"},"isophonics_3_silver_yourname.jams")," from the example at point 2.) by fixing any errors and/or\ninaccuracies"),(0,i.kt)("li",{parentName:"ol"},"once a validation step is finished (i.e. both the preliminary_validation and final_validation levels, see above),\n",(0,i.kt)("a",{parentName:"li",href:"https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request"},"open a pull request"),"\non the ",(0,i.kt)("inlineCode",{parentName:"li"},"validation")," branch of the ChoCo repository.")),(0,i.kt)("h2",{id:"music-expert-evaluation-of-conversions-s2"},"Music expert evaluation of conversions (S2)"),(0,i.kt)("p",null,"To generate more readable annotations for evaluating the output of the chord conversion rules, you can use the following command. This will merge the original and the converted JAMS, and the resulting annotation will be flattened in a CSV file in 'flattened/'. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"cd choco\npython jams_test.py merge ../partitions/when-in-rome/choco score\n")))}c.isMDXComponent=!0}}]);